name: CI for HTML, CSS, and Performance

on:
  push:
    branches:
      - main  # Trigger the workflow when pushing to the main branch
  pull_request:
    branches:
      - main  # Trigger the workflow for pull requests targeting the main branch

jobs:
  lint:
    runs-on: ubuntu-latest  # GitHub Actions runner for Ubuntu
    
    steps:
      - name: Checkout Code
        uses: actions/checkout@v2  # Checkout repository code

      - name: Set Up Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '16'  # Use Node.js version 16

      - name: Install Project Dependencies
        run: |
          npm install  # Install dependencies, including htmlhint and stylelint

      - name: Install htmlhint and stylelint globally
        run: |
          npm install -g htmlhint stylelint  # Install htmlhint and stylelint globally

      - name: Add Global Packages to PATH
        run: |
          echo "/opt/hostedtoolcache/node/16.20.2/x64/bin" >> $GITHUB_PATH  # Add global binaries to PATH

      - name: Verify htmlhint and stylelint installation
        run: |
          npm list -g htmlhint  # Check if htmlhint is installed globally
          npm list -g stylelint  # Check if stylelint is installed globally
          which htmlhint  # Verify that htmlhint is globally available
          which stylelint  # Verify that stylelint is globally available

      - name: Show Project Directory for Debugging
        run: |
          echo "Current project directory:"
          pwd
          echo "Listing files in the repository:"
          ls -la  # List all files and directories to confirm paths

      - name: Run HTMLHint on HTML Files
        run: |
          echo "Running HTMLHint on HTML files..."
          htmlhint '*.html'  # Run htmlhint without verbosity flag

      - name: Run Stylelint on CSS Files
        run: |
          echo "Running Stylelint on CSS files..."
          stylelint 'css/**/*.css' -v  # Lint all CSS files inside the 'css' folder

  performance:
    runs-on: ubuntu-latest  # Runs the performance job on Ubuntu
    
    steps:
      - name: Checkout Code
        uses: actions/checkout@v2  # Checkout repository code

      - name: Set Up Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '16'  # Use Node.js version 16 for Lighthouse CI

      - name: Install Lighthouse CI
        run: |
          npm install -g @lhci/cli  # Install Lighthouse CI tool globally

      - name: Wait for Deployment to be Ready (Optional)
        run: |
          echo "Waiting for deployment to be fully ready..."
          sleep 30  # Wait for 30 seconds to ensure the website is fully deployed

      - name: Run Lighthouse Performance Tests
        run: |
          lhci autorun --url=https://your-deployment-url.com || exit 0  # Replace with your live/staging site URL
          # Suppress errors and continue the pipeline even if performance tests fail
